# 서울 에어비앤비 RevPAR 최적화 대시보드
## 프로젝트 포트폴리오

> **데이터 기간**: 2024-10 ~ 2025-09 (TTM 12개월)
> **리스팅 수**: 32,061개 (Active+Operating 서브셋: 14,399개)
> **분석 컬럼**: 42개
> **Tech Stack**: Python · Streamlit · LightGBM · scikit-learn · pandas · matplotlib

---

## 1. 프로젝트 개요

### 1.1 분석 목적

서울 에어비앤비 시장에서 **RevPAR(Revenue Per Available Room)** 를 최적화하기 위한 인사이트를 두 가지 관점에서 도출합니다.

| 관점 | 분석 단위 | 핵심 질문 |
|------|-----------|-----------|
| **호스트 관점** | 개별 리스팅 | "내가 통제할 수 있는 변수(사진 수, 즉시예약, 최소박 등)가 RevPAR에 얼마나 영향을 주는가?" |
| **플랫폼 관점** | 자치구 단위 | "서울 25개 자치구를 수익 패턴으로 군집화하면 어떤 시장 포지셔닝 전략이 나오는가?" |

### 1.2 KPI 정의

```
RevPAR  = ADR × 예약률
ADR     = 평균 1박 요금 (Average Daily Rate)
TTM     = Trailing 12 Months (최근 12개월)
l90d    = 최근 90일

revpar_trend = (l90d_revpar - ttm_revpar/4) / (ttm_revpar/4 + 1e-6)
```

**핵심 수치 (Active+Operating 기준)**

| 지표 | 전체 (32,061개) | Active+Operating (14,399개) |
|------|----------------|----------------------------|
| RevPAR 중위값 | ₩8,868 | ₩47,850 |
| 슈퍼호스트 RevPAR | - | ₩61,205 |
| 일반 호스트 RevPAR | - | ₩31,825 |
| 슈퍼호스트 프리미엄 | - | **+83.1%** |

---

## 2. 데이터 파이프라인

```
원본 데이터 (32,061행 × 42열)
        ↓
  데이터 전처리 (pre_notebook/_final.ipynb)
  · district 결측 → Spatial Join 보완
  · 이상치 제거: min_nights > 730, ttm_avg_rate > 2,000,000
  · 외부 데이터 병합: POI, 환율, 인구(ttm_pop)
        ↓
  Active+Operating 서브셋 (14,399행)
  · refined_status == 'Active' & operation_status == 'Operating'
        ↓
  ┌─────────────────────────────────────────┐
  │  Host Perspective        Platform View  │
  │  피처 엔지니어링           자치구 집계    │
  │  Train/Test Split (8:2)   K-Means k=4   │
  │  LightGBM + RF + Ridge    군집별 전략    │
  └─────────────────────────────────────────┘
```

**데이터 누수(Leakage) 처리** — 모델링 시 반드시 제외한 특성

| 특성 | 누수 등급 | 사유 |
|------|----------|------|
| `revpar_vs_district_median` | CRITICAL | ttm_revpar 직접 파생 |
| `ttm_occupancy`, `ttm_avg_rate`, `ttm_revenue` | 제외 | RevPAR 직접 구성요소 |
| `l90d_revpar`, `l90d_occupancy` | 제외 | 타겟 관련 기간별 파생 |

---

## 3. 머신러닝 모델링

### 3.1 모델 구성 (호스트 관점)

**목표**: `log1p(ttm_revpar)` 예측 → `expm1()` 역변환으로 실제 RevPAR 산출
**타겟 왜도**: skewness = 3.76 → log1p 변환으로 정규화
**학습 데이터**: 11,519개 | **테스트 데이터**: 2,880개 | **검증**: 5-Fold CV

**사용 피처 (16개)**

```
room_type, superhost, instant_book, bedrooms_group, baths_group, guests_group,
min_nights, extra_guest_fee_policy, rating_overall, photos_count, num_reviews,
nearest_poi_dist_km, nearest_poi_type_name, photos_tier, review_rate, poi_dist_category
```

### 3.2 모델 성능 비교 (테스트 세트 기준)

| 모델 | R² | MAE (₩) | RMSE (₩) | MAPE (%) |
|------|-----|---------|----------|----------|
| DummyRegressor (Baseline) | -0.02 | 40,049 | 66,678 | 259.78 |
| Ridge Regression | 0.57 | 27,594 | 63,064 | 70.39 |
| RandomForest | 0.75 | 24,470 | 47,183 | 45.64 |
| **LightGBM (최종 선택)** | **0.8478** | **19,553** | **38,401** | **32.59** |

**5-Fold CV 결과 (log1p 스케일)**

| 모델 | CV R² | 표준편차 | CV MAE | CV RMSE |
|------|--------|---------|--------|---------|
| Dummy | -0.025 | ±0.006 | - | - |
| Ridge | 0.579 | ±0.011 | 0.276 | 0.306 |
| RandomForest | 0.744 | ±0.010 | 0.245 | 0.272 |
| **LightGBM** | **0.847** | **±0.007** | **0.196** | **0.198** |

> LightGBM은 예측 기대 범위(R² 0.65~0.80)를 **초과 달성**하였으며, 안정적인 CV 표준편차(±0.007)로 과적합 없이 일반화되었습니다.

### 3.3 LightGBM 하이퍼파라미터

```python
lgb_params = {
    "n_estimators":    500,
    "learning_rate":   0.05,
    "num_leaves":      63,
    "min_child_samples": 30,
    "subsample":       0.8,
    "colsample_bytree": 0.8,
    "reg_alpha":       0.1,
    "reg_lambda":      0.1,
}
RANDOM_SEED = 42
```

### 3.4 SHAP 피처 중요도 (Top 10)

| 순위 | 피처 | Mean |SHAP| | 호스트가 통제 가능? |
|------|------|-------------|-------------------|
| 1 | `num_reviews` | 0.5077 | ✅ 간접 (운영 지속) |
| 2 | `review_rate` | 0.3339 | ✅ 간접 |
| 3 | `room_type` | 0.2010 | ✅ 직접 |
| 4 | `rating_overall` | 0.1203 | ✅ 간접 |
| 5 | `guests_group` | 0.1133 | ✅ 직접 |
| 6 | `district_listing_count` | 0.0937 | ❌ 시장 변수 |
| 7 | `min_nights` | 0.0785 | ✅ 직접 |
| 8 | `photos_count` | 0.0706 | ✅ 직접 |
| 9 | `nearest_poi_dist_km` | 0.0540 | ❌ 고정 |
| 10 | `district_operating_rate` | 0.0333 | ❌ 시장 변수 |

**인사이트**: 상위 5개 피처 중 4개가 호스트가 통제 가능한 변수 → 운영 개선으로 RevPAR 향상 여지 충분

### 3.5 모델 아키텍처 (파이프라인)

```
입력값 (호스트 + 지역 통계)
        ↓
  Model A (LightGBM ADR)
  → 시장 적정 ADR 예측 (log1p → expm1 역변환)
        ↓
  price_gap = 호스트 ADR - 시장 ADR  ← 가격 경쟁력 계산
        ↓
  Model B (LightGBM Occupancy)
  → 예약률 예측 (price_gap 피처 포함)
        ↓
  RevPAR_raw = ADR × Occ
        ↓
  Isotonic Regression (보정)
  → RevPAR 최종 보정값 (단조 증가 보장)
        ↓
  월 예상 수익 = RevPAR × 30
  월 순이익   = 월수익 - 운영비
```

### 3.6 플랫폼 관점: 자치구 K-Means 군집 (k=4)

| 군집명 | 자치구 수 | 중위 RevPAR | 휴면 비율 | 대표 자치구 |
|--------|----------|-------------|---------|------------|
| 프리미엄 관광거점 | 1 | ₩63,365 | 50.7% | 마포구 |
| 성장형 주거상권 | 5 | ₩53,051 | 54.5% | 강남·종로·중·서초·용산 |
| 중가 균형시장 | 13 | ₩35,881 | 54.7% | 송파·성동·광진 외 |
| 가격민감 외곽형 | 6 | ₩26,413 | 63.3% | 동대문·동작·구로·관악 외 |

---

## 4. 대시보드 기능 상세

### 4.1 위자드 플로우 (6단계)

```
[Step 1] 숙소 기본 정보
   · 자치구 선택 (25개)
   · 숙소 종류 (집전체/개인실/호텔/다인실)
   · 호스터 유형 선택 (신규 🌱 / 기존 🏅)
          ↓
[Step 2] 요금 & 예약 현황
   · 신규: 숙소 상세 입력 (침실·욕실·인원·주소)
   · 기존: 현재 요금 입력 + 달력 클릭으로 예약 현황 입력
          ↓
[Step 3] 월 운영비 입력
   · 전기·수도·관리비·인터넷·청소비·대출이자·기타
          ↓
[Step 4] 운영 현황 체크 (기존 호스터)
   · 슈퍼호스트·즉시예약·사진 수·추가요금·최소박·평점·리뷰
   · 주소 입력 → 실제 POI 거리 계산
          ↓
[Step 5] 분석 결과 대시보드 (6개 탭)
```

### 4.2 분석 결과 탭 구성

| 탭 | 내용 | 호스트 관점 |
|----|------|-----------|
| 📊 수익 요약 | KPI 3종 + 손익계산서 + **ML 시장 예측** | "나는 지금 시장 대비 어떤 위치?" |
| 💡 요금 전략 | 단계별 추천 요금 + 요금 시뮬레이션 | "요금을 얼마로 설정해야 하나?" |
| 📍 주변 관광지 | 2km 내 POI 분석 + 유형별 분포 | "내 위치의 관광 경쟁력은?" |
| 📋 운영 개선 | 7개 운영 레버 점검 + TOP3 액션 | "지금 당장 개선할 수 있는 게 뭐가?" |
| 🏙️ 지역 진단 | 군집 유형 + 지역 전략 5가지 | "이 지역에서 어떻게 경쟁해야?" |
| 🩺 헬스 스코어 | 5개 지표 바차트 + 개선 액션 | "경쟁 숙소 대비 내 숙소 건강도?" |

### 4.3 달력 예약률 입력 (기존 호스터 전용)

- **2026년 한국 공휴일 20개** 자동 표시 (공휴일명 날짜 하단 표기)
- 클릭으로 예약 날짜 ON/OFF 토글
- 평일(월~금) / 주말(토~일) 예약률 자동 분리 계산
- 예약한 날(primary)은 코랄색, 미예약(secondary)은 흰색

### 4.4 ML 시장 예측 섹션 (Tab1)

기존 단순 통계 기반 추천 → **LightGBM 모델 예측으로 고도화**

| | 이전 (통계 기반) | 이후 (ML 기반) |
|--|----------------|--------------|
| ADR 추천 | 지역 중위값/사분위 범위 | LightGBM 개인화 예측 |
| 예약률 | 지역 평균값 | 호스트 피처 반영 예측 |
| RevPAR | ADR × 지역평균 Occ | ADR × 개인화 Occ (Isotonic 보정) |
| 수익/순이익 | 단순 계산 | 모델 예측 × 30일 - 운영비 |

### 4.5 헬스 스코어 (Tab6 — 기존 호스터)

동일 클러스터 내 Active+Operating 숙소와 백분위 비교

| 컴포넌트 | 계산 방식 | 가중치 |
|----------|-----------|--------|
| 리뷰 신호 | (리뷰 수 백분위 + 평점 백분위) / 2 | 20% |
| 사진 품질 | 23~35장=100점, 범위 벗어날수록 감점 | 20% |
| 예약 정책 | 즉시예약(40%) + 최소박 유연성(40%) + 추가요금 없음(20%) | 20% |
| 위치 | 100 - POI 거리 백분위 | 20% |
| 숙소 구성 | (침실 백분위 + 욕실 백분위) / 2 | 20% |

---

## 5. UI 개선 이력

### 5.1 버튼 색상 시스템 (핵심 수정)

**문제**: 모든 버튼이 오렌지색으로 고정 → 달력 날짜 버튼도 오렌지, 예약 여부 구분 불가
**원인**: 전역 CSS `.stButton > button { background: #FF5A5F !important }` 가 Streamlit DOM 구조상 캘린더 CSS wrapper보다 우선 적용됨
**해결**:
- 전역 버튼 → 흰색 기본값으로 변경
- `type="primary"` 속성 활용: `[data-testid="stBaseButton-primary"]` CSS 타겟
- 다음 단계/분석 결과/재시작 버튼에 `type="primary"` + `nav-primary` wrapper 적용
- 캘린더 예약 날짜 → `type="primary"` (코랄), 미예약 → `type="secondary"` (흰색)
- 달력 루프를 `cols[i].method()` → `with cols[i]:` 문법으로 전환

### 5.2 달력 UI 개선

| 버전 | 변경 내용 |
|------|-----------|
| v1 | 기본 숫자 버튼, 공휴일 없음 |
| v2 | 2026 공휴일 20개 추가, 공휴일명 버튼 내부 표시 |
| v3 | iOS 스타일 재디자인: 일요일 빨강·토요일 파랑, 일 시작 (CSS wrapper 미작동 문제) |
| v4 | CSS wrapper → `type="primary"` 방식으로 전환: 클릭한 날만 코랄색 ✅ |

### 5.3 호스터 유형 분기 위자드

- 신규 호스터: 숙소 상세 입력(침실·욕실·인원·방 스타일) + 지역 평균 예약률 사용
- 기존 호스터: 달력 예약 현황 + 운영 현황 체크(7개 레버) + 단계별 분석

### 5.4 UI 수정 이력 요약

| 커밋 | 주요 변경 |
|------|-----------|
| 8e6b298 | 평일/주말 session state 추가, 네비게이션 버튼 정렬 (nav-balance) |
| 1343727 | 2026 공휴일 추가, 주말 실수익 카드, 본전 요금 → 적자 예방 최소 요금, 리눅스 폰트 |
| 0be776b | iOS 스타일 달력 재디자인 (Sunday-first, 공휴일명 하단) |
| 65b351b | 버튼 색상 근본 수정 (type=primary, 전역 → 흰색) |
| 615abf3 | ML 모델 통합 (RevPAR 예측 + 헬스 스코어) |
| 현재 | 헬스 스코어 독립 탭(tab6) 분리 |

---

## 6. 호스트 관점 핵심 인사이트

### 6.1 통제 가능 변수별 RevPAR 영향

| 변수 | 최적 구간 | RevPAR 효과 |
|------|-----------|------------|
| 슈퍼호스트 | 달성 | **+83.1%** (₩31,825 → ₩61,205) |
| 사진 수 | 21~35장 | 최적 구간 초과 시 한계효용 체감 |
| 최소 숙박일 | 2~3박 | 너무 짧으면 RevPAR 효율 저하, 너무 길면 예약률 감소 |
| 즉시예약 | ON | 비용 없이 예약률 +5~10% 기대 |
| 추가 게스트 요금 | 없음 | 없앴을 때 수익 +25~56% 회복 효과 |
| 숙소 유형 | 집 전체 | 개인실 대비 RevPAR 약 2.7배 |

### 6.2 시장 구조 리스크

- **전체 Dormant 비율 54.3%** — 절반 이상이 비활성화 상태 → 실제 경쟁 공급 과장 우려
- **마포구 공급 집중** — 전체 리스팅의 약 21% → RevPAR 압박 구조
- **최소 숙박일 1박** → 리뷰 축적 비효율, 운영비 대비 수익률 낮음

### 6.3 가격 탄력성 클러스터별 전략

| 클러스터 | 탄력성 | 전략 방향 |
|---------|--------|----------|
| 프리미엄 관광거점 | -0.7 | 요금 인상 여력 있음. 즉시예약 + 영문 최적화 |
| 성장형 주거상권 | -0.8 | 현재 요금 방어. 슈퍼호스트 + 평점 관리 |
| 중가 균형시장 | -1.1 | 사진·즉시예약 등 운영 최적화가 핵심 |
| 가격민감 외곽형 | -1.5 | 요금 인상 자제. 예약률 방어 최우선 |

---

## 7. 기술 스택 & 아키텍처

```
Frontend    : Streamlit (단일 페이지 위자드 앱)
ML          : LightGBM (ADR·예약률 예측) + scikit-learn Isotonic Regression
Data        : pandas · numpy
Visualization: matplotlib (AppleGothic/NanumGothic 한글 폰트)
Geocoding   : Nominatim (OpenStreetMap API) — 주소 → 위경도
POI 분석    : 자체 haversine 거리 계산 + 데이터셋 POI DB (2,965개)
Deploy      : Streamlit Cloud (GitHub 연동, packages.txt: fonts-nanum)
Version Control: Git + GitHub
```

---

## 8. 한계점 및 향후 과제

| 한계 | 내용 | 개선 방향 |
|------|------|-----------|
| 데이터 기간 | TTM 1년 (2024.10~2025.09), 계절성 일부 반영 제한 | 다년도 데이터 확보 |
| 모델 MAPE | 32.59% — 고RevPAR 구간에서 과소예측 경향 | 분위 회귀(Quantile Regression) 추가 |
| 신규 호스터 예측 | 리뷰/평점 0 → 모델 입력 불완전 | Cold-start 처리 로직 고도화 |
| 동적 가격 | 현재는 정적 ADR 권고 | 날짜별 수요 탄력성 반영한 동적 가격 추천 |
| 플랫폼 뷰 | Ridge + LOO CV (n=25 소표본 한계) | 분기별 패널 데이터로 확장 |

---

*Built with Claude Code · 데이터: 서울 에어비앤비 공개 리스팅 (2024-10 ~ 2025-09)*
